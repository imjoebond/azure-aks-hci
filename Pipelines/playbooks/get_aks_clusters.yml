- name: Get AKS Clusters
  hosts: hcimanager


  vars_files: 
    - vars/aks_setup_vars.yml

  tasks:
  - name: Get AKS Clusters
    ansible.windows.win_shell:  "Get-AksHciCluster | ConvertTo-Json"
    register: aks_cluster_info
  
  - name: set cluster info fact
    set_fact:
      cluster_info: "{{ aks_cluster_info.stdout | from_json  }}"
    when: aks_cluster_info.stdout
  
  - name: print cluster info
    debug:
      msg: "cluster {{ cluster_info }}"
    when: cluster_info is defined
  
  - name: print no clusters found
    debug:
      msg: "No clusters found on node"
    when: cluster_info is undefined
      
